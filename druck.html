<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Belastungskonto 3.9.1.4</title>
<style>
:root{
--green:#34c759; --yellow:#ffcc00; --orange:#ff9500; --red:#ff3b30;
--blue:#007aff; --gray:#8e8e93; --pause:#5856d6;
}
body{font-family:-apple-system,system-ui,sans-serif; background:#f2f2f7; margin:0; padding:12px; padding-top:85px; -webkit-tap-highlight-color: transparent;}

.card{background: #fff; border-radius:16px; padding:16px; margin-bottom:12px; box-shadow:0 4px 12px rgba(0,0,0,.15); transition: background-color 0.3s, color 0.3s;}

.mode-green .card { background-color: var(--green); color: #fff; }
.mode-yellow .card { background-color: var(--yellow); color: #000; }
.mode-orange .card { background-color: var(--orange); color: #fff; }
.mode-red .card { background-color: var(--red); color: #fff; }

.card h3, .card strong { color: inherit; }

button{width:100%;padding:14px;border:none;border-radius:12px;font-weight:700;font-size:16px;color:#fff;cursor:pointer;transition:opacity 0.2s; touch-action: manipulation;}
button:active{opacity:0.7;}
.btn-start{background:var(--blue);margin-top:12px}
.btn-reset{background:var(--gray);margin-top:8px;font-size:13px;}
.btn-add{background:var(--blue);width:auto;padding:10px 14px;margin-top:6px; white-space: nowrap;}

.btn-pause{background:var(--pause);margin-bottom:4px;display:none}
.pause-hint{display:none;font-size:12px;padding:8px;border-radius:8px;margin-bottom:12px;line-height:1.4;border-left:4px solid var(--pause); background: rgba(255,255,255,0.2); color: inherit;}

#pacingHeader{position:fixed;top:0;left:0;width:100%;padding:10px;text-align:center;font-weight:800;z-index:2000;display:none;box-shadow:0 2px 10px rgba(0,0,0,0.2);box-sizing:border-box;}
.warn-rot{background:var(--red);color:#fff;}
.warn-pene{background:#000;color:var(--yellow);border-bottom:3px solid var(--red);}
.blink{animation:blinker 0.9s linear infinite;}
@keyframes blinker{50%{opacity:0.3;}}

.status-wrap{display:none;gap:10px;margin-bottom:12px}
.status{flex:1;border-radius:14px;padding:14px;color:#fff;font-weight:800;text-align:center; box-shadow: 0 4px 10px rgba(0,0,0,0.15);}
.big{font-size:2rem;display:block;margin:5px 0}

.bg-green{background:var(--green)}
.bg-yellow{background:var(--yellow);color:#000}
.bg-orange{background:var(--orange)}
.bg-red{background:var(--red)}

.item{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(0,0,0,0.1)}
.small-btn{width:34px;height:34px;padding:0;font-size:14px;border-radius:8px;margin-left:4px;display:inline-flex;align-items:center;justify-content:center;}
.btn-sort{background:rgba(0,0,0,0.1); color:inherit; font-size:16px;}
input,select{width:100%;padding:12px;border:1px solid rgba(0,0,0,0.1);border-radius:10px;font-size:16px;margin-top:6px;box-sizing:border-box;background:rgba(255,255,255,0.9); color:#000;}

#toast{
position:fixed; bottom:30px; left:50%; transform:translateX(-50%);
background:rgba(0,0,0,0.8); color:#fff; padding:12px 24px; border-radius:20px;
font-weight:bold; display:none; z-index:3000; pointer-events:none;
}
</style>
</head>
<body id="mainBody">

<div id="pacingHeader"></div>
<div id="toast">Erfasst üëçüèº</div>

<div id="statusWrap" class="status-wrap">
<div class="status bg-green" id="boxLimit">Limit<span id="valStart" class="big">0</span></div>
<div id="boxRest" class="status bg-green">Rest<span id="valRest" class="big">0</span></div>
</div>

<button id="pauseBtn" class="btn-pause" onclick="doPause()">‚òï PAUSE (+3 & Block-Reset)</button>
<div id="pauseHint" class="pause-hint">
<strong>Hinweis:</strong> Ruhe zur Puls-Normalisierung ist KEINE Pause!
</div>

<div class="card" id="cardCheck">
<h3>Morgen-Check</h3>
<input id="sleep" type="number" placeholder="Schlafindex (z.B. 65)">
<select id="feeling">
<option value="" disabled selected>Wie f√ºhlst du dich?</option>
<option value="12">Es geht mir gut (+12)</option>
<option value="4">Leichter Druck, es geht aber (+4)</option>
<option value="-6">Starker Druck/Nebel, es geht irgendwie (-6)</option>
<option value="-12">Schwerer Druck, Pfeifen, es geht nichts (-12)</option>
</select>
<button class="btn-start" onclick="startDay()">Tag starten</button>
<button class="btn-reset" onclick="resetDay()">Neuer Tag (Reset)</button>
</div>

<div class="card" id="cardCatalog">
<h3>Belastungskatalog</h3>
<div style="display:flex;gap:6px;align-items:flex-end;">
<input id="loadName" style="flex:2" placeholder="Aktivit√§t">
<input id="loadVal" style="flex:0.8" type="number" placeholder="Pkt.">
<button class="btn-add" style="flex:0.5" onclick="addCatalogEntry()">üíæ Neu</button>
</div>
<div id="catalog" style="margin-top: 15px;"></div>
</div>

<div class="card" id="cardUsed">
<h3>Heutige Aktivit√§ten</h3>
<div id="dayList"></div>
<button onclick="undoLast()" style="background:var(--orange); width:100%; padding:14px; border:none; border-radius:12px; font-weight:700; color:#fff; margin-top:15px">Letzten Eintrag r√ºckg√§ngig</button>
</div>

<div style="margin-top: 20px; text-align: center;">
<button id="showCheckBtn" style="background:none; color:var(--gray); font-size:12px; text-decoration:underline; display:none;" onclick="toggleCheck()">Morgen-Check bearbeiten</button>
</div>

<script>
const STORAGE_LOADS = "pacing_catalog_data"
const STORAGE_STATE = "pacing_daily_state"

const myLoads = [
{n: "Puls > 88", v: 1},
{n: "3-Minuten-Arbeiten", v: 2},
{n: "Aufstehen", v: 3},
{n: "Leichte Arbeiten (Fr√ºhst√ºck/Bett)", v: 2},
{n: "30 Min. achtsame Bewegung", v: 5},
{n: "L√§ngere leichte Arbeiten", v: 10},
{n: "√Ñrgern", v: 10},
{n: "Problem w√§lzen", v: 10},
{n: "L√§ngere starke Konzentration", v: 10}
];

let loads = JSON.parse(localStorage.getItem(STORAGE_LOADS)) || myLoads;
let state = JSON.parse(localStorage.getItem(STORAGE_STATE)) || { max: 0, cur: 0, block: 0, used: [], date: "", pene: false };

window.onload = function() {
const today = new Date().toDateString();
if (state.date && state.date !== today && state.max > 0) {
if(confirm("Guten Morgen! Neuen Tag beginnen?")) { resetDayInternal(); }
}
if (state.max > 0) {
showMainUI();
updateDisplay();
}
renderCatalog();
};

function saveAll() {
localStorage.setItem(STORAGE_LOADS, JSON.stringify(loads));
localStorage.setItem(STORAGE_STATE, JSON.stringify(state));
}

function showToast(msg = "Erfasst üëçüèº") {
const t = document.getElementById("toast");
t.textContent = msg;
t.style.display = "block"
setTimeout(() => { t.style.display = "none" }, 1500);
}

function startDay() {
const s = document.getElementById("sleep").value;
const f = document.getElementById("feeling").value;
if(!f || !s || s <= 0) return alert("Bitte Schlafindex und Gef√ºhl eingeben.");
state.max = parseInt(s) + parseInt(f);
state.cur = state.max;
state.used = [];
state.block = 0;
state.pene = false;
state.date = new Date().toDateString();
showMainUI();
saveAll();
updateDisplay();
}

function showMainUI() {
document.getElementById("statusWrap").style.display = "flex"
document.getElementById("pauseBtn").style.display = "block"
document.getElementById("pauseHint").style.display = "block"
document.getElementById("cardCheck").style.display = "none" // Ausblenden
document.getElementById("showCheckBtn").style.display = "inline-block" // Button unten zeigen
}

function toggleCheck() {
const card = document.getElementById("cardCheck");
card.style.display = card.style.display === "none" ? "block" : "none"
}

function updateDisplay() {
document.getElementById("valStart").textContent = state.max;
document.getElementById("valRest").textContent = state.cur;
const p = (state.cur / state.max) * 100;
const body = document.getElementById("mainBody");
const boxRest = document.getElementById("boxRest");
const boxLimit = document.getElementById("boxLimit");

body.className = ""
boxRest.className = "status"
boxLimit.className = "status"

if(p > 75) { body.classList.add("mode-green"); boxRest.classList.add("bg-green"); boxLimit.classList.add("bg-green"); }
else if(p > 50) { body.classList.add("mode-yellow"); boxRest.classList.add("bg-yellow"); boxLimit.classList.add("bg-yellow"); }
else if(p > 25) { body.classList.add("mode-orange"); boxRest.classList.add("bg-orange"); boxLimit.classList.add("bg-orange"); }
else { body.classList.add("mode-red"); boxRest.classList.add("bg-red"); boxLimit.classList.add("bg-red"); }

const header = document.getElementById("pacingHeader");
if (state.block >= 30) {
header.style.display = "block"
header.className = "warn-pene"
header.innerHTML = `<span class="blink">‚ö° PAUSE ERZWINGEN! ‚ö°</span><br><small>Block: ${state.block}</small>`;
if(!state.pene) {
state.cur = Math.max(0, state.cur - 1);
state.used.push({n: "‚ö†Ô∏è STRAFE: PENE-Warnung", v: 1, t: nowTime()});
state.pene = true;
saveAll();
updateDisplay();
}
} else if (state.block >= 20) {
header.style.display = "block"
header.className = "warn-rot"
header.innerHTML = `PAUSE EMPFOHLEN! (Block: ${state.block})`;
} else {
header.style.display = "none"
}
renderUsed();
}

function nowTime() { return new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}); }

function addCatalogEntry() {
const n = document.getElementById("loadName").value.trim();
const v = parseInt(document.getElementById("loadVal").value);
if(!n || isNaN(v)) return;
loads.push({n, v});
saveAll();
renderCatalog();
document.getElementById("loadName").value = ""
document.getElementById("loadVal").value = ""
showToast("Gespeichert üíæ");
}

function renderCatalog() {
const div = document.getElementById("catalog");
div.innerHTML = ""
loads.forEach((l, i) => {
div.innerHTML += `<div class="item">
<span style="flex-grow:1;cursor:pointer;padding:8px 0;" onclick="applyLoad(${i})"><strong>${l.n}</strong> (${l.v})</span>
<div style="display:flex;">
<button class="small-btn" style="background:var(--blue); color:#fff" onclick="applyLoad(${i})">+</button>
<button class="small-btn" style="background:var(--gray); color:#fff" onclick="editCatalog(${i})">‚úé</button>
<button class="small-btn" style="background:var(--red); color:#fff" onclick="deleteCatalog(${i})">‚úï</button>
<button class="small-btn btn-sort" onclick="moveItem(${i}, -1)">‚Üë</button>
<button class="small-btn btn-sort" onclick="moveItem(${i}, 1)">‚Üì</button>
</div>
</div>`;
});
}

function moveItem(index, direction) {
const newIndex = index + direction;
if (newIndex >= 0 && newIndex < loads.length) {
const temp = loads[index];
loads[index] = loads[newIndex];
loads[newIndex] = temp;
saveAll();
renderCatalog();
}
}

function applyLoad(i) {
if(state.max <= 0) return alert("Bitte erst den Tag starten!");
state.cur = Math.max(0, state.cur - loads[i].v);
state.block += loads[i].v;
state.used.push({...loads[i], t: nowTime()});
saveAll();
updateDisplay();
showToast();
}

function renderUsed() {
const div = document.getElementById("dayList");
div.innerHTML = ""
state.used.slice().reverse().forEach(u => {
const isPause = u.v < 0;
div.innerHTML += `<div class="item"><span><span style="font-size:11px;opacity:0.8;margin-right:8px">${u.t || ''}</span> <span>${u.n}</span></span><span>${isPause?'+':'-'}${Math.abs(u.v)}</span></div>`;
});
}

function doPause() {
state.cur += 3;
state.block = 0;
state.pene = false;
state.used.push({n: "‚òï Pause", v: -3, t: nowTime()});
saveAll();
updateDisplay();
showToast("Pause verbucht ‚òï");
}

function undoLast() {
if(state.used.length === 0) return;
const last = state.used.pop();
if(last.n.includes("STRAFE")) {
state.cur += 1; state.pene = false; state.block = 29;
} else {
state.cur += last.v;
if(last.v > 0) state.block = Math.max(0, state.block - last.v);
}
saveAll();
updateDisplay();
}

function resetDay() {
if(!confirm("Tag wirklich zur√ºcksetzen?")) return;
resetDayInternal();
}

function resetDayInternal() {
state = { max: 0, cur: 0, block: 0, used: [], date: "", pene: false };
localStorage.setItem(STORAGE_STATE, JSON.stringify(state));
document.getElementById("sleep").value = ""
document.getElementById("feeling").selectedIndex = 0;
location.reload();
}

function editCatalog(i) {
const n = prompt("Name:", loads[i].n), v = prompt("Punkte:", loads[i].v);
if(n && v) {
loads[i] = {n, v: parseInt(v)};
saveAll();
renderCatalog();
}
}

function deleteCatalog(i) {
if(confirm("L√∂schen?")) {
loads.splice(i, 1);
saveAll();
renderCatalog();
}
}
</script>
</body>
</html>